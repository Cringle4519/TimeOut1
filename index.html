 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TimeOut</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0f16;--card:#121826;--muted:#8ea0b8;--text:#e6eefc;--accent:#6ea8ff;--danger:#ff6b6b;--ok:#40c057;--warn:#ffd43b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .app{max-width:480px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,15,22,.9),rgba(11,15,22,.6) 70%,transparent);backdrop-filter:blur(6px);z-index:3}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
  .brand{font-weight:700;letter-spacing:.3px}
  .score-badge{font-weight:700;border-radius:999px;padding:6px 12px;background:rgba(110,168,255,.16);border:1px solid rgba(110,168,255,.35)}
  .tabs{display:flex;gap:8px;padding:0 12px 12px}
  .tab{flex:1;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--muted);font-weight:600}
  .tab.active{background:var(--card);color:var(--text);border-color:rgba(255,255,255,.12)}
  main{flex:1;padding:14px}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;margin-bottom:12px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  h2{margin:0 0 10px;font-size:18px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:var(--text);padding:12px 14px;border-radius:12px;font-weight:700}
  .btn.wide{width:100%;text-align:center}
  .btn.primary{background:var(--accent);border-color:transparent;color:#081120}
  .btn.danger{background:var(--danger)}
  .btn.ok{background:var(--ok)}
  .btn.warn{background:var(--warn);color:#231a00}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);font-size:12px}
  input,textarea{width:100%;background:#0d1422;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:12px;border-radius:12px}
  textarea{min-height:110px;resize:vertical}
  .q{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);margin-bottom:8px}
  .q .label{font-weight:600;font-size:14px;flex:1}
  .toggle{display:flex;gap:6px}
  .chip{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0d1422;color:var(--muted);font-weight:700}
  .chip.active.y{background:rgba(64,192,87,.2);color:#bff3c7;border-color:rgba(64,192,87,.5)}
  .chip.active.n{background:rgba(255,107,107,.18);color:#ffd6d6;border-color:rgba(255,107,107,.45)}
  .meter{height:12px;border-radius:999px;background:#0d1422;border:1px solid rgba(255,255,255,.08);overflow:hidden}
  .meter > span{display:block;height:100%;background:linear-gradient(90deg,#40c057,#ffd43b,#ff6b6b);width:0%}
  .help{color:var(--muted);font-size:12px;margin-top:6px}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{padding:10px;border-radius:12px;background:#0d1422;border:1px solid rgba(255,255,255,.08)}
  .muted{color:var(--muted)}
  footer{padding:16px;text-align:center;color:var(--muted);font-size:12px}
  .hidden{display:none !important}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="topbar">
      <div class="brand">TimeOut</div>
      <div class="score-badge">Trust: <span id="scoreText">--</span>%</div>
    </div>
    <div class="tabs">
      <button class="tab active" data-tab="home">Home</button>
      <button class="tab" data-tab="questions">8 Questions</button>
      <button class="tab" data-tab="checkin">Check-In</button>
      <button class="tab" data-tab="history">History</button>
      <button class="tab" data-tab="profile">Profile</button>
      <button class="tab" data-tab="settings">Settings</button>
    </div>
  </header>

  <main>
    <!-- HOME -->
    <section id="tab-home">
      <div class="card">
        <h2>Timer</h2>
        <div class="row" style="justify-content:space-between">
          <div class="pill" id="timerText">00:00:00</div>
          <div class="row">
            <button class="btn ok" id="startBtn">Start</button>
            <button class="btn warn" id="pauseBtn">Pause</button>
            <button class="btn danger" id="resetBtn">Reset</button>
          </div>
        </div>
        <div class="help">Use this when you need a focused “time-out” moment.</div>
      </div>

      <div class="card">
        <h2>Quick Actions</h2>
        <div class="grid2">
          <button class="btn wide" id="quickSafe">I’m Safe</button>
          <button class="btn wide danger" id="quickUnsafe">Need Help</button>
          <button class="btn wide" id="quickReset">Quick Reset</button>
          <button class="btn wide" id="shareBtn">Share App Link</button>
        </div>
      </div>

      <div class="card">
        <h2>Trust Score</h2>
        <div class="meter"><span id="scoreBar"></span></div>
        <div class="help">Answer the 8 Questions daily. Safer answers raise your score.</div>
      </div>
    </section>

    <!-- QUESTIONS -->
    <section id="tab-questions" class="hidden">
      <div class="card">
        <h2>8 Questions (Today)</h2>
        <div id="qList"></div>
        <button class="btn primary wide" id="saveAnswers">Save Answers</button>
        <div class="help">Green = “Yes, I feel ok” where appropriate. Red flags reduce score.</div>
      </div>
    </section>

    <!-- CHECK-IN -->
    <section id="tab-checkin" class="hidden">
      <div class="card">
        <h2>Daily Check-In</h2>
        <div class="row">
          <select id="moodSel" class="btn" style="flex:1">
            <option value="calm">Calm</option>
            <option value="okay">Okay</option>
            <option value="anxious">Anxious</option>
            <option value="unsafe">Unsafe</option>
          </select>
          <button class="btn primary" id="saveCheckin">Save</button>
        </div>
        <textarea id="noteBox" placeholder="Anything you want to note about today…"></textarea>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="tab-history" class="hidden">
      <div class="card">
        <h2>History</h2>
        <div class="list" id="historyList"></div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="exportJson">Export JSON</button>
          <button class="btn danger" id="wipeAll">Erase All Local Data</button>
        </div>
        <div class="help">Stored only on your device (LocalStorage). Export before erasing if you want a copy.</div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="tab-profile" class="hidden">
      <div class="card">
        <h2>Profile</h2>
        <label class="muted">Display Name</label>
        <input id="nameInput" placeholder="Your name or alias" />
        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="saveProfile">Save Profile</button>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="hidden">
      <div class="card">
        <h2>Settings</h2>
        <div class="row">
          <span class="muted">Theme</span>
          <div class="row">
            <button class="btn" data-theme="dark">Dark</button>
            <button class="btn" data-theme="light">Light</button>
          </div>
        </div>
        <div class="help">You can install this as a shortcut on your phone’s home screen from your browser menu.</div>
      </div>
    </section>
  </main>

  <footer>TimeOut · Local-only demo · v1.0</footer>
</div>

<script>
/* ---------- Storage Helpers ---------- */
const store = {
  get(key, def){ try{ return JSON.parse(localStorage.getItem(key)) ?? def; }catch(e){ return def; } },
  set(key,val){ localStorage.setItem(key, JSON.stringify(val)); },
  push(key,val){ const arr = store.get(key,[]); arr.push(val); store.set(key,arr); }
};

/* ---------- State ---------- */
const state = {
  profile: store.get('profile', { name:'' }),
  settings: store.get('settings', { theme:'dark' }),
  answersByDay: store.get('answersByDay', {}), // yyyy-mm-dd => [true/false/...]
  checkins: store.get('checkins', []),
  score: store.get('score', 50),
  timer: { running:false, startAt:0, elapsed:0 }
};

/* ---------- UI Bindings ---------- */
const tabs = document.querySelectorAll('.tab');
const sections = {
  home: document.getElementById('tab-home'),
  questions: document.getElementById('tab-questions'),
  checkin: document.getElementById('tab-checkin'),
  history: document.getElementById('tab-history'),
  profile: document.getElementById('tab-profile'),
  settings: document.getElementById('tab-settings')
};
const scoreText = document.getElementById('scoreText');
const scoreBar = document.getElementById('scoreBar');

function showTab(name){
  tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
  Object.entries(sections).forEach(([k,el])=>el.classList.toggle('hidden', k!==name));
  if(name==='history') renderHistory();
  if(name==='questions') renderQuestions();
  if(name==='profile') document.getElementById('nameInput').value = state.profile.name || '';
}

/* ---------- Timer ---------- */
const timerText = document.getElementById('timerText');
let rafId = null;
function fmt(ms){
  const s = Math.floor(ms/1000);
  const h = String(Math.floor(s/3600)).padStart(2,'0');
  const m = String(Math.floor((s%3600)/60)).padStart(2,'0');
  const sec = String(s%60).padStart(2,'0');
  return `${h}:${m}:${sec}`;
}
function tick(){
  const now = Date.now();
  const elapsed = state.timer.elapsed + (state.timer.running ? (now - state.timer.startAt) : 0);
  timerText.textContent = fmt(elapsed);
  rafId = requestAnimationFrame(tick);
}
document.getElementById('startBtn').onclick = ()=>{
  if(!state.timer.running){ state.timer.running = true; state.timer.startAt = Date.now(); }
};
document.getElementById('pauseBtn').onclick = ()=>{
  if(state.timer.running){
    state.timer.elapsed += Date.now() - state.timer.startAt;
    state.timer.running = false;
  }
};
document.getElementById('resetBtn').onclick = ()=>{
  state.timer.running = false; state.timer.elapsed = 0; state.timer.startAt = 0;
};
document.getElementById('quickReset').onclick = ()=>{
  state.timer.running = false; state.timer.elapsed = 0; state.timer.startAt = 0;
  alert('Quick reset done.');
};
document.getElementById('shareBtn').onclick = ()=>{
  const url = location.href;
  if(navigator.share){ navigator.share({ title:'TimeOut', url }); }
  else { navigator.clipboard?.writeText(url); alert('Link copied.'); }
};
document.getElementById('quickSafe').onclick = ()=>{
  bumpScore(+2); addHistory({type:'flag', level:'ok', note:'User tapped “I’m Safe”.'});
};
document.getElementById('quickUnsafe').onclick = ()=>{
  bumpScore(-8); addHistory({type:'flag', level:'risk', note:'User tapped “Need Help”.'});
};

/* ---------- 8 Questions ---------- */
const QUESTIONS = [
  { t:'Do you feel physically safe right now?', good:'yes' },
  { t:'Do you have access to a private, safe space?', good:'yes' },
  { t:'Has anyone threatened you today?', good:'no' },
  { t:'Are you able to contact someone you trust?', good:'yes' },
  { t:'Do you have the essentials (food/meds)?', good:'yes' },
  { t:'Is anyone monitoring your device?', good:'no' },
  { t:'Do you have a plan if you feel unsafe?', good:'yes' },
  { t:'Have boundaries been respected today?', good:'yes' }
];
function todayKey(){ const d=new Date(); return d.toISOString().slice(0,10); }
function renderQuestions(){
  const qList = document.getElementById('qList');
  qList.innerHTML = '';
  const key = todayKey();
  const saved = state.answersByDay[key] || Array(QUESTIONS.length).fill(null);
  QUESTIONS.forEach((q,idx)=>{
    const row = document.createElement('div');
    row.className = 'q';
    row.innerHTML = `
      <div class="label">${q.t}</div>
      <div class="toggle">
        <button class="chip ${saved[idx]===true?'active y':''}" data-i="${idx}" data-v="yes">Yes</button>
        <button class="chip ${saved[idx]===false?'active n':''}" data-i="${idx}" data-v="no">No</button>
      </div>`;
    qList.appendChild(row);
  });
  qList.querySelectorAll('.chip').forEach(btn=>{
    btn.onclick = ()=>{
      const i = Number(btn.dataset.i);
      const v = btn.dataset.v === 'yes';
      const cur = state.answersByDay[key] || Array(QUESTIONS.length).fill(null);
      cur[i] = v;
      state.answersByDay[key] = cur;
      store.set('answersByDay', state.answersByDay);
      renderQuestions();
    };
  });
}
document.getElementById('saveAnswers').onclick = ()=>{
  const key = todayKey();
  const a = state.answersByDay[key] || [];
  if(a.length !== QUESTIONS.length || a.some(v => v===null)){
    alert('Please answer all 8 questions.'); return;
  }
  // scoring
  let delta = 0;
  a.forEach((ans,i)=>{
    const good = QUESTIONS[i].good === 'yes';
    if(ans === good) delta += 2; else delta -= 4;
  });
  bumpScore(delta);
  addHistory({ type:'answers', date:key, answers:a, delta });
  alert('Saved. Trust score updated.');
};

/* ---------- Check-In ---------- */
document.getElementById('saveCheckin').onclick = ()=>{
  const mood = document.getElementById('moodSel').value;
  const note = document.getElementById('noteBox').value.trim();
  const entry = { type:'checkin', ts:Date.now(), mood, note };
  store.push('checkins', entry);
  state.checkins = store.get('checkins', []);
  addHistory({ type:'checkin', mood });
  if(mood==='unsafe') bumpScore(-6);
  else if(mood==='anxious') bumpScore(-2);
  else if(mood==='calm') bumpScore(+1);
  document.getElementById('noteBox').value='';
  alert('Check-in saved.');
};

/* ---------- Profile / Settings ---------- */
document.getElementById('saveProfile').onclick = ()=>{
  state.profile.name = document.getElementById('nameInput').value.trim();
  store.set('profile', state.profile);
  alert('Profile saved.');
};
document.querySelectorAll('[data-theme]').forEach(b=>{
  b.onclick = ()=> setTheme(b.dataset.theme);
});
function setTheme(t){
  if(t==='light'){
    document.documentElement.style.setProperty('--bg','#f6f7fb');
    document.documentElement.style.setProperty('--card','#ffffff');
    document.documentElement.style.setProperty('--text','#0b0f16');
  }else{ // dark default
    document.documentElement.style.setProperty('--bg','#0b0f16');
    document.documentElement.style.setProperty('--card','#121826');
    document.documentElement.style.setProperty('--text','#e6eefc');
  }
  state.settings.theme = t; store.set('settings', state.settings);
}

/* ---------- History / Export ---------- */
function addHistory(entry){
  const items = store.get('history', []);
  items.unshift({ ...entry, at:Date.now() });
  store.set('history', items);
}
function renderHistory(){
  const box = document.getElementById('historyList');
  const items = store.get('history', []);
  if(items.length===0){ box.innerHTML = '<div class="muted">No history yet.</div>'; return; }
  box.innerHTML = '';
  items.slice(0,200).forEach(it=>{
    const d = new Date(it.at).toLocaleString();
    const li = document.createElement('div');
    li.className = 'item';
    li.innerHTML = `<div class="row" style="justify-content:space-between">
        <strong>${it.type}</strong><span class="muted">${d}</span>
      </div>
      <div class="muted">${it.note||it.mood||''} ${it.delta!==undefined?('(Δ '+it.delta+')'):''}</div>`;
    box.appendChild(li);
  });
}
document.getElementById('exportJson').onclick = ()=>{
  const dump = {
    profile: state.profile,
    settings: state.settings,
    score: state.score,
    answersByDay: state.answersByDay,
    checkins: store.get('checkins', []),
    history: store.get('history', [])
  };
  const blob = new Blob([JSON.stringify(dump,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'timeout-data.json'; a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('wipeAll').onclick = ()=>{
  if(!confirm('Erase ALL local data on this device?')) return;
  localStorage.clear(); location.reload();
};

/* ---------- Score ---------- */
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function bumpScore(delta){
  state.score = clamp((state.score||50) + delta, 0, 100);
  store.set('score', state.score);
  renderScore();
}
function renderScore(){
  scoreText.textContent = String(state.score);
  scoreBar.style.width = state.score + '%';
}

/* ---------- Nav ---------- */
tabs.forEach(t=> t.onclick = ()=> showTab(t.dataset.tab));

/* ---------- Boot ---------- */
(function boot(){
  setTheme(state.settings.theme || 'dark');
  renderScore();
  renderQuestions();
  renderHistory();
  cancelAnimationFrame(rafId); tick(); // start timer UI loop
})();
</script>
</body>
</html>             
