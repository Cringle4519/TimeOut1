<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TimeOut</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#0d1117; color:#eaeaea; font-family:sans-serif; }
    .hidden { display:none; }
    .tab-btn { padding:0.5rem 1rem; cursor:pointer; }
    .tab-btn.active { border-bottom:2px solid #38bdf8; }
    .card { background:#1f2937; border-radius:0.5rem; padding:1rem; margin-top:1rem; }
    .btn { padding:0.5rem 0.75rem; border-radius:0.25rem; }
    .btn-primary { background:#38bdf8; color:#000; }
    .btn-ghost { background:transparent; border:1px solid #555; }
    .small { font-size:0.85rem; opacity:0.85; }
  </style>
</head>
<body class="p-4">

  <!-- Decoy Landing -->
  <div id="decoy" class="text-center">
    <h1 id="decoyTitle" class="text-2xl font-bold">TimeOut</h1>
    <div id="clock" class="mt-6 text-5xl font-mono">25:00</div>
    <div class="mt-4 flex justify-center space-x-2">
      <button id="quickExit" class="btn btn-ghost">Quick Exit</button>
      <button id="panic" class="btn btn-ghost">Lock</button>
    </div>
    <div class="mt-2 small">v1.3.5</div>
  </div>

  <!-- PIN Modal -->
  <div id="pinModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center">
    <div class="bg-gray-800 p-6 rounded-xl w-80">
      <h2 class="text-lg font-bold mb-4">Enter PIN</h2>
      <input id="pinInput" type="password" class="w-full p-2 mb-4 text-black rounded" placeholder="PIN"/>
      <button id="pinSubmit" class="btn btn-primary w-full">Unlock</button>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="hidden">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-bold">TimeOut App</h1>
      <button id="lockBtn" class="btn btn-ghost">Lock</button>
    </div>
    <div class="flex space-x-4 mb-4">
      <button class="tab-btn active" data-tab="home">Home</button>
      <button class="tab-btn" data-tab="checkin">Check-In</button>
      <button class="tab-btn" data-tab="resources">Resources</button>
      <button class="tab-btn" data-tab="profile">Profile</button>
    </div>
    <div id="tab-home" class="tab">
      <div class="card">Welcome <span id="userName">User</span></div>
    </div>
    <div id="tab-checkin" class="tab hidden">
      <h2 class="font-bold mb-2">Check-In</h2>
      <div id="questions"></div>
      <button id="saveCheckIn" class="btn btn-primary mt-2">Save Answers</button>
      <button id="demoLoadBtn" class="btn btn-ghost mt-2">Load Demo Answers</button>
      <div id="scores" class="mt-3"></div>
      <div id="checkFeedback"></div>
    </div>
    <div id="tab-resources" class="tab hidden">
      <div class="card">Resources (placeholder)</div>
    </div>
    <div id="tab-profile" class="tab hidden">
      <div class="card">
        <label class="block mb-2">Change PIN</label>
        <input id="newPin" type="password" class="w-full p-2 mb-2 text-black rounded" placeholder="New PIN"/>
        <button id="savePin" class="btn btn-primary">Save PIN</button>
      </div>
    </div>
  </div>

<script>
const $=id=>document.getElementById(id);
let pin="2580", duress="1111", unlocked=false;
let answers={}, trust=100;

// Decoy clock
let time=1500; function tick(){const m=Math.floor(time/60),s=time%60; $("clock").textContent=`${m}:${s.toString().padStart(2,"0")}`; time--; if(time<0) time=1500;}
setInterval(tick,1000);

// Long-press unlock
let pressTimer;
$("decoyTitle").addEventListener("mousedown",()=>{pressTimer=setTimeout(()=>{$("pinModal").classList.remove("hidden");},800);});
["mouseup","mouseleave"].forEach(e=>$("decoyTitle").addEventListener(e,()=>clearTimeout(pressTimer)));

// PIN submit
$("pinSubmit").onclick=()=>{
  const val=$("pinInput").value;
  if(val===pin){ unlockApp(); }
  else if(val===duress){ unlockFake(); }
  else { alert("Wrong PIN"); }
};
function unlockApp(){ $("decoy").classList.add("hidden"); $("pinModal").classList.add("hidden"); $("app").classList.remove("hidden"); unlocked=true; }
function unlockFake(){ alert("Duress mode: fake screen"); $("pinModal").classList.add("hidden"); }

// Quick Exit
$("quickExit").onclick=()=>location.href="https://google.com";
// Lock
$("panic").onclick=$("lockBtn").onclick=()=>{ $("app").classList.add("hidden"); $("decoy").classList.remove("hidden"); unlocked=false; };

// Tabs
document.querySelectorAll(".tab-btn").forEach(btn=>btn.onclick=()=>{document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));btn.classList.add("active");document.querySelectorAll(".tab").forEach(t=>t.classList.add("hidden"));$("tab-"+btn.dataset.tab).classList.remove("hidden");});

// Check-In
const QUESTIONS=[
{id:"q1",text:"Are you currently safe where you are?"},
{id:"q2",text:"Has someone threatened you recently?"},
{id:"q3",text:"Have you experienced physical harm in past month?"},
{id:"q4",text:"Are you worried about your partnerâ€™s access to your phone?"},
{id:"q5",text:"Is anyone preventing you from leaving?"},
{id:"q6",text:"Do you have children at risk?"},
{id:"q7",text:"Do you feel isolated from help?"},
{id:"q8",text:"Would you like immediate local resources?"}
];
function renderQuestions(){ $("questions").innerHTML=""; QUESTIONS.forEach(q=>{const d=document.createElement("div");d.className="card";d.innerHTML=`<div>${q.text}</div>
  <button class="btn btn-ghost" onclick="setAns('${q.id}','yes')">Yes</button>
  <button class="btn btn-ghost" onclick="setAns('${q.id}','no')">No</button>`; $("questions").append(d); });}
renderQuestions();
function setAns(id,val){answers[id]=val;}

// Save + Scores + Feedback
$("saveCheckIn").onclick=()=>{ showScores(); showFeedback(); };
$("demoLoadBtn").onclick=()=>{ answers={q1:"no",q2:"yes",q3:"no",q4:"yes",q5:"no",q6:"no",q7:"yes",q8:"yes"}; showScores(); showFeedback(); };

function showScores(){ const risk=Object.values(answers).filter(v=>v==="yes").length*12.5; trust=100-risk; $("scores").innerHTML=`Risk: ${risk}% | Trust: ${trust}%`; }
function showFeedback(){ 
  const risk=100-trust, lang="en"; let tier="green"; if(risk>=66) tier="red"; else if(risk>=26) tier="yellow";
  const FEEDBACK={
    green:{title:"You're doing okay",body:"Low risk right now. Keep connected and update your plan."},
    yellow:{title:"Some concerns",body:"There are warning signs. Update your plan, talk to someone you trust."},
    red:{title:"High risk",body:"Danger signs detected. If in danger, call emergency services."}
  };
  $("checkFeedback").innerHTML=`<div class="card"><div class="font-bold">${FEEDBACK[tier].title}</div><div>${FEEDBACK[tier].body}</div></div>`;
}
</script>
</body>
</html>
